<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>

---

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<link rel="stylesheet" href="https://cdn.datatables.net/2.0.8/css/dataTables.dataTables.css" />
<script src="https://cdn.datatables.net/2.0.8/js/dataTables.js"></script>

<table id="ranking_table" style="width:100%;">
<thead></thead>
<tfoot></tfoot>
<tbody></tbody>
</table>

<script>
var DEFAULT_ATTACKER_LEVEL = 40;
var DEFAULT_ATTACKER_CPM = 0.7903;
var DEFAULT_ATTACKER_IVs = [15, 15, 15];
var DEFAULT_ENEMY_DPS1 = 900;
var DEFAULT_ENEMY_LEVEL = 40;
var DEFAULT_ENEMY_CPM = 0.7903;
var DEFAULT_ENEMY_IVs = [15, 15, 15];
var DEFAULT_ENEMY_CURRENT_DEFENSE = 160;
var DEFAULT_ENEMY_POKETYPE1 = 'none';
var DEFAULT_ENEMY_POKETYPE2 = 'none';
var DEFAULT_WEATHER = 'EXTREME';
var DEFAULT_TOTAL_ENERGY_GAINED = 400;
var DEFAULT_STAB = 1.2;
var GM = {}; // Game Master
var list = [];
var Data = {
	BattleSettings: {
		'dodgeDurationMs': 500,
		'dodgeWindowMs': 700,
		'swapDurationMs': 1000,
		'quickSwapCooldownDurationMs': 60000,
		'arenaEntryLagMs': 3000,
		'arenaEarlyTerminationMs': 3000,
		'fastMoveLagMs': 25,
		'chargedMoveLagMs': 100,
		'rejoinDurationMs': 10000,
		'itemMenuAnimationTimeMs': 2000,
		'maxReviveTimePerPokemonMs': 1000,
		'timelimitGymMs': 100000,
		'timelimitRaidMs': 180000,
		'timelimitLegendaryRaidMs': 300000,
		'timelimitPvPMs': 240000,
		'shadowPokemonAttackBonusMultiplier': 1.2,
		'shadowPokemonDefenseBonusMultiplier': 0.8333333,
		'purifiedPokemonAttackMultiplierVsShadow': 1.0,
		//mega pokemon multipliers
		'sameTypeAttackBonusMultiplierMega': 1.3,
		'megaPokemonStatMultiplier': 1.1,
		'sameTypeAttackBonusMultiplier': 1.2,
		'weatherAttackBonusMultiplier': 1.2,
		'fastAttackBonusMultiplier': 1.3,
		'chargeAttackBonusMultiplier': 1.3,
		'attackBuffMultiplier': [0.5, 0.5714286, 0.6666667, 0.8, 1.0, 1.25, 1.5, 1.75, 2.0],
		'defenseBuffMultiplier': [0.5, 0.5714286, 0.6666667, 0.8, 1.0, 1.25, 1.5, 1.75, 2.0],
		'minimumStatStage': -4,
		'maximumStatStage': 4,

		'maxEnergy': 100,
		'energyDeltaPerHealthLost': 0.5,
		'dodgeDamageReductionPercent': 0.75,

		TypeEffectiveness: { "bug": { "bug": 1, "dark": 1.6, "dragon": 1, "electric": 1, "fairy": 0.625, "fighting": 0.625, "fire": 0.625, "flying": 0.625, "ghost": 0.625, "grass": 1.6, "ground": 1, "ice": 1, "normal": 1, "poison": 0.625, "psychic": 1.6, "rock": 1, "steel": 0.625, "water": 1 }, "dark": { "bug": 1, "dark": 0.625, "dragon": 1, "electric": 1, "fairy": 0.625, "fighting": 0.625, "fire": 1, "flying": 1, "ghost": 1.6, "grass": 1, "ground": 1, "ice": 1, "normal": 1, "poison": 1, "psychic": 1.6, "rock": 1, "steel": 1, "water": 1 }, "dragon": { "bug": 1, "dark": 1, "dragon": 1.6, "electric": 1, "fairy": 0.390625, "fighting": 1, "fire": 1, "flying": 1, "ghost": 1, "grass": 1, "ground": 1, "ice": 1, "normal": 1, "poison": 1, "psychic": 1, "rock": 1, "steel": 0.625, "water": 1 }, "electric": { "bug": 1, "dark": 1, "dragon": 0.625, "electric": 0.625, "fairy": 1, "fighting": 1, "fire": 1, "flying": 1.6, "ghost": 1, "grass": 0.625, "ground": 0.390625, "ice": 1, "normal": 1, "poison": 1, "psychic": 1, "rock": 1, "steel": 1, "water": 1.6 }, "fairy": { "bug": 1, "dark": 1.6, "dragon": 1.6, "electric": 1, "fairy": 1, "fighting": 1.6, "fire": 0.625, "flying": 1, "ghost": 1, "grass": 1, "ground": 1, "ice": 1, "normal": 1, "poison": 0.625, "psychic": 1, "rock": 1, "steel": 0.625, "water": 1 }, "fighting": { "bug": 0.625, "dark": 1.6, "dragon": 1, "electric": 1, "fairy": 0.625, "fighting": 1, "fire": 1, "flying": 0.625, "ghost": 0.390625, "grass": 1, "ground": 1, "ice": 1.6, "normal": 1.6, "poison": 0.625, "psychic": 0.625, "rock": 1.6, "steel": 1.6, "water": 1 }, "fire": { "bug": 1.6, "dark": 1, "dragon": 0.625, "electric": 1, "fairy": 1, "fighting": 1, "fire": 0.625, "flying": 1, "ghost": 1, "grass": 1.6, "ground": 1, "ice": 1.6, "normal": 1, "poison": 1, "psychic": 1, "rock": 0.625, "steel": 1.6, "water": 0.625 }, "flying": { "bug": 1.6, "dark": 1, "dragon": 1, "electric": 0.625, "fairy": 1, "fighting": 1.6, "fire": 1, "flying": 1, "ghost": 1, "grass": 1.6, "ground": 1, "ice": 1, "normal": 1, "poison": 1, "psychic": 1, "rock": 0.625, "steel": 0.625, "water": 1 }, "ghost": { "bug": 1, "dark": 0.625, "dragon": 1, "electric": 1, "fairy": 1, "fighting": 1, "fire": 1, "flying": 1, "ghost": 1.6, "grass": 1, "ground": 1, "ice": 1, "normal": 0.390625, "poison": 1, "psychic": 1.6, "rock": 1, "steel": 1, "water": 1 }, "grass": { "bug": 0.625, "dark": 1, "dragon": 0.625, "electric": 1, "fairy": 1, "fighting": 1, "fire": 0.625, "flying": 0.625, "ghost": 1, "grass": 0.625, "ground": 1.6, "ice": 1, "normal": 1, "poison": 0.625, "psychic": 1, "rock": 1.6, "steel": 0.625, "water": 1.6 }, "ground": { "bug": 0.625, "dark": 1, "dragon": 1, "electric": 1.6, "fairy": 1, "fighting": 1, "fire": 1.6, "flying": 0.390625, "ghost": 1, "grass": 0.625, "ground": 1, "ice": 1, "normal": 1, "poison": 1.6, "psychic": 1, "rock": 1.6, "steel": 1.6, "water": 1 }, "ice": { "bug": 1, "dark": 1, "dragon": 1.6, "electric": 1, "fairy": 1, "fighting": 1, "fire": 0.625, "flying": 1.6, "ghost": 1, "grass": 1.6, "ground": 1.6, "ice": 0.625, "normal": 1, "poison": 1, "psychic": 1, "rock": 1, "steel": 0.625, "water": 0.625 }, "normal": { "bug": 1, "dark": 1, "dragon": 1, "electric": 1, "fairy": 1, "fighting": 1, "fire": 1, "flying": 1, "ghost": 0.390625, "grass": 1, "ground": 1, "ice": 1, "normal": 1, "poison": 1, "psychic": 1, "rock": 0.625, "steel": 0.625, "water": 1 }, "poison": { "bug": 1, "dark": 1, "dragon": 1, "electric": 1, "fairy": 1.6, "fighting": 1, "fire": 1, "flying": 1, "ghost": 0.625, "grass": 1.6, "ground": 0.625, "ice": 1, "normal": 1, "poison": 0.625, "psychic": 1, "rock": 0.625, "steel": 0.390625, "water": 1 }, "psychic": { "bug": 1, "dark": 0.390625, "dragon": 1, "electric": 1, "fairy": 1, "fighting": 1.6, "fire": 1, "flying": 1, "ghost": 1, "grass": 1, "ground": 1, "ice": 1, "normal": 1, "poison": 1.6, "psychic": 0.625, "rock": 1, "steel": 0.625, "water": 1 }, "rock": { "bug": 1.6, "dark": 1, "dragon": 1, "electric": 1, "fairy": 1, "fighting": 0.625, "fire": 1.6, "flying": 1.6, "ghost": 1, "grass": 1, "ground": 0.625, "ice": 1.6, "normal": 1, "poison": 1, "psychic": 1, "rock": 1, "steel": 0.625, "water": 1 }, "steel": { "bug": 1, "dark": 1, "dragon": 1, "electric": 0.625, "fairy": 1.6, "fighting": 1, "fire": 0.625, "flying": 1, "ghost": 1, "grass": 1, "ground": 1, "ice": 1.6, "normal": 1, "poison": 1, "psychic": 1, "rock": 1.6, "steel": 0.625, "water": 0.625 }, "water": { "bug": 1, "dark": 1, "dragon": 0.625, "electric": 1, "fairy": 1, "fighting": 1, "fire": 1.6, "flying": 1, "ghost": 1, "grass": 0.625, "ground": 1.6, "ice": 1, "normal": 1, "poison": 1, "psychic": 1, "rock": 1.6, "steel": 1, "water": 0.625 } },

		TypeBoostedWeather: {
			"grass": "CLEAR",
			"ground": "CLEAR",
			"fire": "CLEAR",
			"dark": "FOG",
			"ghost": "FOG",
			"fairy": "CLOUDY",
			"fighting": "CLOUDY",
			"poison": "CLOUDY",
			"normal": "PARTLY_CLOUDY",
			"rock": "PARTLY_CLOUDY",
			"water": "RAINY",
			"electric": "RAINY",
			"bug": "RAINY",
			"ice": "SNOW",
			"steel": "SNOW",
			"dragon": "WINDY",
			"flying": "WINDY",
			"psychic": "WINDY"
		},

		FriendSettings: [
			{
				'name': "none",
				'label': "Lv.0 Non-Friend",
				'multiplier': 1.0
			},
			{
				'name': "good",
				'label': "Lv.1 Good Friend",
				'multiplier': 1.03
			},
			{
				'name': "great",
				'label': "Lv.2 Great Friend",
				'multiplier': 1.05
			},
			{
				'name': "ultra",
				'label': "Lv.3 Ultra Friend",
				'multiplier': 1.07
			},
			{
				'name': "best",
				'label': "Lv.4 Best Friend",
				'multiplier': 1.10
			},
		],
	},


	Weathers: [
		{ 'name': 'EXTREME', 'label': "Extreme" },
		{ 'name': 'CLEAR', 'label': "Clear" },
		{ 'name': 'FOG', 'label': "Fog" },
		{ 'name': 'CLOUDY', 'label': "Cloudy" },
		{ 'name': 'PARTLY_CLOUDY', 'label': "Partly Cloudy" },
		{ 'name': 'RAINY', 'label': "Rainy" },
		{ 'name': 'SNOW', 'label': "Snow" },
		{ 'name': 'WINDY', 'label': "Windy" }
	],

	RaidTierSettings: [
		{ "name": "1", "label": "Tier 1", "cpm": 0.6, "maxHP": 600, "timelimit": 180000 },
		{ "name": "2", "label": "Tier 2", "cpm": 0.67, "maxHP": 1800, "timelimit": 180000 },
		{ "name": "3", "label": "Tier 3", "cpm": 0.7300000190734863, "maxHP": 3600, "timelimit": 180000 },
		{ "name": "4", "label": "Tier 4", "cpm": 0.7900000214576721, "maxHP": 9000, "timelimit": 180000 },
		{ "name": "5", "label": "Tier 5", "cpm": 0.7900000214576721, "maxHP": 15000, "timelimit": 300000 },
		{ "name": "6", "label": "Tier 6", "cpm": 0.7900000214576721, "maxHP": 18750, "timelimit": 300000 }
	],

	RaidBosses: [],

	Pokemon: [],

	PokemonForms: [],

	FastMoves: [],

	ChargedMoves: [],

	LevelSettings: [],

	IndividualValues: [{ "name": "0", "value": 0 }, { "name": "1", "value": 1 }, { "name": "2", "value": 2 }, { "name": "3", "value": 3 }, { "name": "4", "value": 4 }, { "name": "5", "value": 5 }, { "name": "6", "value": 6 }, { "name": "7", "value": 7 }, { "name": "8", "value": 8 }, { "name": "9", "value": 9 }, { "name": "10", "value": 10 }, { "name": "11", "value": 11 }, { "name": "12", "value": 12 }, { "name": "13", "value": 13 }, { "name": "14", "value": 14 }, { "name": "15", "value": 15 }],

	Users: []

};


fetchPokemon();

function fetchPokemon() {
	$.ajax({
		url: "/assets/pokemon_stats.json",
		dataType: 'json',
		async: false,
		success: function (data) {
			$.each(data, function(i){
				var pkm = {
          id: data[i].pokemon_id,
          name: data[i].pokemon_name,
          form: data[i].form,
          baseAtk: data[i].base_attack,
          baseDef: data[i].base_defense,
          baseStm: data[i].base_stamina
        };
				Data.Pokemon.push(pkm);
			});
      Data.Pokemon.sort((a, b) => (a.name < b.name ? -1 : 1));
			Data.Pokemon.sorted = true;
		},
		complete: function () {}
	});
}

function damage(dmg_giver, dmg_taker, move, weather) {
	var multipliers = 1;
	if (move.pokeType == dmg_giver.pokeType1 || move.pokeType == dmg_giver.pokeType2) {
			multipliers *= DEFAULT_STAB;
		}
	var Effectiveness = GM.get("battle", "TypeEffectiveness");
	multipliers *= Effectiveness[move.pokeType][dmg_taker.pokeType1] || 1;
	multipliers *= Effectiveness[move.pokeType][dmg_taker.pokeType2] || 1;
	var atk = dmg_giver.Atk;
	if (dmg_giver.name.startsWith("shadow ")) {
		atk *= Data.BattleSettings.shadowPokemonAttackBonusMultiplier;
	}
	if (Context.allyMega) {
		atk *= Data.BattleSettings.megaPokemonStatMultiplier;
	}
	return 0.5 * atk / dmg_taker.Def * move.power * multipliers + 0.5;
}

function round(value, numDigits) {
	var multiplier = Math.pow(10, parseInt(numDigits) || 0);
	return Math.round(value * multiplier) / multiplier;
}

$(function(){
//	$($("#ranking_table").DataTable().column(5).header()).text('ER');
	var table = $("#ranking_table").DataTable({
		lengthChange: false,
		autoWidth: false,
		deferRender: true,
		columns: [
			{ title: "Pokemon", data: "name", width: "14%" },
			{ title: "Base Attack", data: "baseAtk", width: "18%" },
			{ title: "Base Defense", data: "baseDef", width: "18%" },
			{ title: "Base Stamina", data: "baseStm", type: "num", width: "10%", orderSequence: ["desc", "asc"] }
		],
		scrollX: true
	});

  
	for (let pkm of Data.Pokemon) {
//		pkm.img = "x";
		//pkm.overall = round((pkm.dps ** 3 * pkm.tdo) ** 0.25, 2);
		table.row.add(pkm);
	}
  
	//table.order([3, 'desc']);
	table.draw();
});
</script>
</body>
</html>